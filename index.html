const CLIENT_USERNAME = "Ashok";
const CLIENT_PASSWORD = "12345";

// Mock CSV data
const csvData = `
Date,Stock,Amount,Status
02-01-2025,Stock A,5000,Profit
02-01-2025,Stock B,2000,Loss
02-01-2025,Stock C,3000,Profit
01-01-2025,Stock D,4000,Loss
`;

const loginForm = document.getElementById('login-form');
const loginPage = document.getElementById('login-page');
const dashboardPage = document.getElementById('dashboard-page');

// Load data into the table
function loadTableData(csv) {
  const rows = csv.trim().split('\n').slice(1);
  const tableBody = document.querySelector('#log-table tbody');
  tableBody.innerHTML = ''; // Clear old data

  rows.forEach(row => {
    const columns = row.split(',');
    const tr = document.createElement('tr');
    columns.forEach(col => {
      const td = document.createElement('td');
      td.textContent = col.trim();
      tr.appendChild(td);
    });
    tableBody.appendChild(tr);
  });
}

// Calculate and display summary values
function calculateSummary(csv) {
  let totalInvestment = 0;
  let totalProfit = 0;

  csv.trim().split('\n').slice(1).forEach(row => {
    const [, , amount, status] = row.split(',');
    const value = parseFloat(amount.trim());
    if (status.trim() === "Profit") totalProfit += value;
    totalInvestment += value;
  });

  document.getElementById('total-investment').querySelector('p').textContent = `₹${totalInvestment.toLocaleString()}`;
  document.getElementById('total-profit').querySelector('p').textContent = `+₹${totalProfit.toLocaleString()}`;
  document.getElementById('total-profit').querySelector('p').style.color = 'green';
}

// Calculate today's PnL
function calculateTodaysPnL(csv) {
  const today = new Date().toLocaleDateString('en-GB'); // Format: DD-MM-YYYY
  let todaysPnL = 0;

  csv.trim().split('\n').slice(1).forEach(row => {
    const [date, , amount, status] = row.split(',');
    const value = parseFloat(amount.trim());
    if (date.trim() === today && status.trim() === "Profit") {
      todaysPnL += value;
    } else if (date.trim() === today && status.trim() === "Loss") {
      todaysPnL -= value;
    }
  });

  const todaysPnLEl = document.getElementById('todays-pnl').querySelector('p');
  todaysPnLEl.textContent = `₹${todaysPnL.toLocaleString()}`;
  todaysPnLEl.style.color = todaysPnL >= 0 ? 'green' : 'red';
}

// Login form submit handler
loginForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();

  if (username === CLIENT_USERNAME && password === CLIENT_PASSWORD) {
    loginPage.classList.add('hidden');
    dashboardPage.classList.remove('hidden');
    loadTableData(csvData);
    calculateSummary(csvData);
    calculateTodaysPnL(csvData);
  } else {
    alert('Invalid username or password. Please try again.');
  }
});
